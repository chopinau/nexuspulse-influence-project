module.exports=[72862,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(27496),e=a.i(53572),f=a.i(39061),g=a.i(7291);let h=async(a,b)=>{if(!a||"#"===a||!a.startsWith("http"))return[];let c=`&_t=${Date.now()}`;for(let d of[`https://api.allorigins.win/raw?url=${encodeURIComponent(a)}${c}`,`https://corsproxy.io/?${encodeURIComponent(a)}`,`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(a)}`])try{let a=await fetch(d);if(!a.ok)continue;let c=await a.text();if(!c.includes("<rss")&&!c.includes("<feed")&&!c.includes("<item")&&!c.includes("<entry"))continue;let e=new DOMParser().parseFromString(c,"text/xml"),f=Array.from(e.querySelectorAll("item, entry")).slice(0,2);if(0===f.length)continue;return f.map(a=>{let c=a.querySelector("title")?.textContent||"No Title",d=a.querySelector("link"),e=d?.textContent||d?.getAttribute("href")||"#",f=a.querySelector("pubDate, published, updated")?.textContent,g=(a=>{if(!a)return new Date;let b=new Date(a);if(!isNaN(b.getTime()))return b;let c=Date.parse(a);return isNaN(c)?new Date:new Date(c)})(f).toISOString();return{id:`rss-${b}-${Math.random().toString(36).substr(2,9)}`,title:c,url:e,timestamp:g,summary:(a.querySelector("description, summary, content")?.textContent||"").replace(/<[^>]*>?/gm,"").substring(0,80)+"...",source:b,type:"rss"}})}catch{continue}return[]};function i(){let a=(0,e.useTranslations)("home.dynamics"),{data:i}=(0,d.default)("global-config",async()=>{try{let{data:a,error:b}=await g.supabase.from("config").select("*");if(b)return console.warn("[LiveGlobalFeed] Failed to fetch config:",b),[];return console.log("[LiveGlobalFeed] Fetched",a?.length,"config rows"),a}catch(a){return console.warn("[LiveGlobalFeed] Error fetching config:",a),[]}},{refreshInterval:12e4,revalidateOnFocus:!0}),{data:j,isLoading:k,mutate:l}=(0,d.default)("global-dynamics",async()=>{try{let{data:a,error:b}=await g.supabase.from("dynamics").select("*").order("pub_date",{ascending:!1}).limit(20);if(b)throw b;return console.log("[LiveGlobalFeed] Fetched",a?.length,"items from dynamics table"),a}catch(a){return console.warn("[LiveGlobalFeed] Failed to fetch dynamics:",a),[]}},{refreshInterval:6e4,revalidateOnFocus:!0}),[m,n]=(0,c.useState)([]),[o,p]=(0,c.useState)(!0),[q,r]=(0,c.useState)(!1);(0,c.useEffect)(()=>{(async()=>{p(!0),r(!0);let a=[];if(j&&(a=[...a,...j.map(a=>({id:a.id,title:a.title,url:a.url||a.link||"#",timestamp:a.pub_date||a.created_at||new Date().toISOString(),summary:a.summary||a.content_snippet||"",source:a.source||"NexusPulse",type:"signal",sentiment:a.sentiment||"neutral"}))]),i&&i.length>0){let b=[];i.forEach(a=>{[a.rss,a.main_rss,a.google_news_rss,a.googlenewsrss,a.mainrss].forEach(c=>{c&&b.push(h(c,a.name||"Unknown"))})}),b.length>0&&(a=[...a,...(await Promise.all(b)).flat()])}a.sort((a,b)=>{let c=new Date(a.timestamp).getTime();return new Date(b.timestamp).getTime()-c}),console.log("[LiveGlobalFeed] Combined",(a=a.slice(0,20)).length,"items from all sources"),n(a),p(!1),r(!1)})()},[j,i,k]);let{mutate:s}=(0,d.default)("global-config"),t=async()=>{console.log("[LiveGlobalFeed] Manual refresh triggered"),p(!0),r(!0),await Promise.all([s(),l()]),await new Promise(a=>setTimeout(a,500)),p(!1),r(!1)};return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center px-2",children:[(0,b.jsx)("h2",{className:"text-lg font-bold text-gray-200",children:a("title")}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(o||k)&&(0,b.jsx)("span",{className:"text-xs text-cyber-neon animate-pulse",children:"Syncing..."}),(0,b.jsxs)("button",{onClick:t,className:"text-xs text-cyber-neon hover:underline flex items-center gap-1",children:[(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-3 h-3",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})}),"Refresh"]})]})]}),(0,b.jsx)("div",{className:"space-y-4 max-h-[600px] overflow-y-auto pr-2 custom-scrollbar",children:m.length>0?m.map((a,c)=>(0,b.jsxs)(f.default,{className:`!p-4 ${"manual"===a.type?"border-cyber-neon/40 bg-cyber-neon/5":""}`,delay:.05*c,children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,b.jsx)("span",{className:"text-[10px] text-gray-500 font-mono",children:new Date(a.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,b.jsx)("span",{className:`text-[10px] px-1.5 py-0.5 rounded border ${"manual"===a.type?"border-cyber-neon text-cyber-neon font-bold shadow-[0_0_5px_rgba(0,243,255,0.3)]":"signal"===a.type?"border-cyber-green text-cyber-green font-bold":"border-cyber-purple/30 text-cyber-purple"}`,children:"manual"===a.type?"BRIEFING":"signal"===a.type?"SIGNAL":a.source})]}),(0,b.jsx)("h4",{className:"text-sm font-bold text-gray-100 mb-1 leading-tight hover:text-cyber-neon cursor-pointer",children:"#"!==a.url?(0,b.jsx)("a",{href:a.url,target:"_blank",rel:"noreferrer",children:a.title}):a.title}),(0,b.jsx)("p",{className:"text-xs text-gray-400 line-clamp-3 mb-2 leading-relaxed",children:a.summary}),"#"!==a.url&&(0,b.jsxs)("div",{className:"flex justify-between items-center text-[10px] text-gray-500",children:[(0,b.jsxs)("span",{children:["Via ","signal"===a.type?"Database":"RSS"]}),(0,b.jsx)("a",{href:a.url,target:"_blank",rel:"noreferrer",className:"hover:text-cyber-neon",children:"Read Source ↗"})]})]},a.id)):!o&&(0,b.jsxs)("div",{className:"p-4 text-center text-gray-500 text-sm",children:["Waiting for satellite uplink... ",(0,b.jsx)("br",{}),(0,b.jsx)("span",{className:"text-xs opacity-50",children:"(Check Sheet Config)"})]})})]})}a.s(["default",()=>i])},65088,a=>{"use strict";var b=a.i(87924),c=a.i(27496),d=a.i(53572),e=a.i(39061),f=a.i(7291),g=a.i(17177);function h(){(0,d.useTranslations)("home");let a=(0,d.useTranslations)("home.stats"),{data:h,error:i,isLoading:j}=(0,c.default)("dashboard-config",async()=>{try{console.log("[LiveDashboardGrid] Fetching dashboard data from Supabase...");let{data:a,error:b}=await f.supabase.from("config").select("*");if(b)throw console.warn("[LiveDashboardGrid] Supabase error, falling back to mock data:",b.message),b;return console.log("[LiveDashboardGrid] Data loaded successfully from Supabase:",a?.length,"entities found"),a}catch(a){return console.warn("[LiveDashboardGrid] Fetch Error/Fallback:",a),g.ENTITIES.map(a=>({id:a.id,slug:a.slug,name:a.name,type:a.type,heatindex:a.heatIndex,trend:a.trend,stocksymbol:a.stockSymbol,tags:a.tags.join(","),summary:""}))}},{refreshInterval:3e4,revalidateOnFocus:!0,errorRetryCount:3,errorRetryInterval:5e3,onError:(a,b)=>{console.error("[LiveDashboardGrid] SWR Error:",a,{key:b})}});if(console.log("SWR 数据：",h),console.log("SWR 错误：",i),console.log("加载中：",j),j)return(0,b.jsx)("section",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(a=>(0,b.jsx)("div",{className:"h-64 rounded-2xl bg-white/5 animate-pulse border border-white/5"},a))});if(i)return(0,b.jsxs)("section",{className:"text-center p-8 bg-red-500/10 border border-red-500/20 rounded-2xl",children:[(0,b.jsx)("h2",{className:"text-lg font-bold text-red-400 mb-2",children:"Dashboard Data Error"}),(0,b.jsx)("p",{className:"text-sm text-gray-400",children:"Failed to load live dashboard data. Please try again later."}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Error: ",i instanceof Error?i.message:"Unknown error"]})]});let k=h?.filter(a=>a.name&&a.slug)||[];return 0===k.length?(0,b.jsxs)("section",{className:"text-center p-8 bg-gray-800/50 border border-gray-700/50 rounded-2xl",children:[(0,b.jsx)("h2",{className:"text-lg font-bold text-gray-400 mb-2",children:"No Entities Found"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"No entities configured in Supabase."}),(0,b.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Check the Supabase config table or contact support."})]}):(0,b.jsx)("section",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:k.slice(0,4).map((c,f)=>{let g=c.heatindex?parseInt(c.heatindex):0,h=c.trend?parseFloat(c.trend):0,i=c.tags?c.tags.split(",").map(a=>a.trim()):[],j=c.type||"person";return(0,b.jsx)(d.Link,{href:"person"===j?`/person/${c.slug}`:`/category/${c.slug}`,className:"block h-full",children:(0,b.jsxs)(e.default,{delay:.1*f,className:"cursor-pointer h-full group",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,b.jsx)("span",{className:`text-xs px-2 py-1 rounded border ${"person"===j?"border-cyber-purple/50 text-cyber-purple":"border-cyber-green/50 text-cyber-green"}`,children:j.toUpperCase()}),(0,b.jsxs)("div",{className:`flex items-center gap-1 text-sm font-bold ${h>=0?"text-cyber-green":"text-red-500"}`,children:[(0,b.jsx)("span",{children:h>=0?"▲":"▼"}),(0,b.jsxs)("span",{children:[Math.abs(h),"%"]})]})]}),(0,b.jsx)("h3",{className:"text-2xl font-bold mb-1 group-hover:text-cyber-neon transition-colors",children:c.name}),(0,b.jsxs)("div",{className:"flex items-end justify-between mt-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wider",children:a("heatIndex")}),(0,b.jsxs)("div",{className:"flex items-baseline gap-1",children:[(0,b.jsx)("p",{className:"text-3xl font-mono text-cyber-neon drop-shadow-[0_0_8px_rgba(0,243,255,0.5)]",children:g}),(0,b.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-cyber-green animate-pulse mb-1",title:"Live Data"})]})]}),(0,b.jsx)("div",{className:"flex gap-1 flex-wrap justify-end max-w-[50%]",children:i.slice(0,2).map(a=>(0,b.jsx)("span",{className:"text-[10px] bg-white/5 px-2 py-0.5 rounded text-gray-400",children:a},a))})]})]})},c.slug)})})}a.s(["default",()=>h])}];

//# sourceMappingURL=components_8f9b0168._.js.map